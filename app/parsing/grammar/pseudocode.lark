// ============================================================================
// GRAM√ÅTICA LARK PARA ANALIZADOR DE COMPLEJIDADES
// Basada en sintaxis tipo Pascal con extensiones para objetos y grafos
// ============================================================================

// ============================================================================
// PROGRAMA PRINCIPAL
// ============================================================================

start: program

program: class_definition* algorithm

// ============================================================================
// DEFINICI√ìN DE CLASES (antes del algoritmo principal)
// ============================================================================

class_definition: CNAME "{" attribute_list "}"

attribute_list: CNAME+

// ============================================================================
// ALGORITMO PRINCIPAL Y SUBRUTINAS
// ============================================================================

algorithm: subroutine_definition* main_algorithm

main_algorithm: "begin" local_declarations? statement* "end"

subroutine_definition: CNAME "(" parameter_list? ")" "begin" local_declarations? statement* "end"

// ============================================================================
// DECLARACIONES LOCALES (vectores al inicio del algoritmo)
// ============================================================================

local_declarations: local_declaration+

local_declaration: CNAME "[" expression "]"
                 | CNAME CNAME

// ============================================================================
// PAR√ÅMETROS DE SUBRUTINAS
// ============================================================================

parameter_list: parameter ("," parameter)*

parameter: array_parameter
         | object_parameter
         | simple_parameter

array_parameter: CNAME ("[" expression? "]")+ (".." "[" expression "]")?

object_parameter: CNAME CNAME

simple_parameter: CNAME

// ============================================================================
// SENTENCIAS
// ============================================================================

statement: assignment ";"?
         | for_loop
         | while_loop
         | repeat_loop
         | if_statement
         | call_statement ";"?
         | return_statement ";"?
         | comment

// ----------------------------------------------------------------------------
// ASIGNACI√ìN
// ----------------------------------------------------------------------------

assignment: variable ASSIGN expression

// ----------------------------------------------------------------------------
// CICLOS
// ----------------------------------------------------------------------------

for_loop: "for" CNAME ASSIGN expression "to" expression "do" block

while_loop: "while" "(" condition ")" "do" block

repeat_loop: "repeat" statement+ "until" "(" condition ")"

// ----------------------------------------------------------------------------
// CONDICIONALES
// ----------------------------------------------------------------------------

if_statement: "if" "(" condition ")" "then" block ("else" block)?

// ----------------------------------------------------------------------------
// LLAMADAS A SUBRUTINAS
// ----------------------------------------------------------------------------

call_statement: "call" CNAME "(" argument_list? ")"

argument_list: expression ("," expression)*

// ----------------------------------------------------------------------------
// RETURN
// ----------------------------------------------------------------------------

return_statement: "return" expression

// ============================================================================
// BLOQUES DE C√ìDIGO
// ============================================================================

block: "begin" statement* "end"
     | statement

// ============================================================================
// VARIABLES Y ACCESO A DATOS
// ============================================================================

variable: CNAME "." CNAME ("[" expression "]")+
        | CNAME "." CNAME
        | CNAME ("[" expression "]")+
        | CNAME "[" range "]"
        | CNAME

range: expression ".." expression

// ============================================================================
// EXPRESIONES
// ============================================================================

expression: logical_or

logical_or: logical_and ("or" logical_and)*

logical_and: logical_not ("and" logical_not)*

logical_not: "not" logical_not
           | comparison

comparison: arithmetic (comp_op arithmetic)*

comp_op: "<" | ">" | "<=" | ">=" | "=" | "!=" | "‚â§" | "‚â•" | "‚â†"

arithmetic: term ((PLUS|MINUS) term)*

term: factor ((STAR|SLASH|"mod"|"div") factor)*

factor: (PLUS | MINUS) factor
      | power

power: atom (CIRCUMFLEX atom)*

atom: NUMBER
    | BOOLEAN
    | NULL
    | variable
    | function_call
    | "(" expression ")"
    | ceiling
    | floor
    | length

length: "length" "(" variable ")"

ceiling: "‚îå" expression "‚îê"

floor: "‚îî" expression "‚îò"

function_call: CNAME "(" argument_list? ")"

condition: expression

comment: COMMENT

// ============================================================================
// TERMINALES
// ============================================================================

ASSIGN: "ü°®" | ":="

BOOLEAN: "T" | "F" | "true" | "false"

NULL: "NULL" | "null"

NUMBER: /\d+(\.\d+)?/

CNAME: /[a-zA-Z_][a-zA-Z0-9_]*/

COMMENT: /‚ñ∫[^\n]*/

// Operadores aritm√©ticos (solo s√≠mbolos)
PLUS: "+"
MINUS: "-"
STAR: "*"
SLASH: "/"
CIRCUMFLEX: "^"

%import common.WS
%ignore WS